# MineOpt Model Structure - Technical Documentation

## Overview

This document describes the data structures for MineOpt simulation models. The model configuration is stored as a JSON file.

---

## Table of Contents

1. [Top-Level Structure](#top-level-structure)
2. [Nodes](#nodes)
3. [Roads](#roads)
4. [Load Zones](#load-zones)
5. [Dump Zones](#dump-zones)

---

## Top-Level Structure

```json
{
  "version": "string",
  "map_id": "number",
  "map_translate": { },
  "machine_list": { },
  "parameters": [ ],
  "settings": { },
  "zone_defaults": { },
  "default_powernode_priorities": { },
  "economic_settings": { },
  "nodes": [ ],
  "roads": [ ],
  "trolleys": [ ],
  "chargers": [ ],
  "service_stations": [ ],
  "load_zones": [ ],
  "dump_zones": [ ],
  "haulers": [ ],
  "loaders": [ ],
  "routes": [ ],
  "simulates": [ ],
  "explorations": [ ],
  "esses": [ ],
  "power_management": { },
  "electrical_distributions": [ ],
  "operations": { },
  "local_machines": { },
  "batteries": [ ],
  "crushers": [ ],
  "routeProcess": { },
  "cameraPosition": { },
  "controlTarget": { }
}
```

### Top-Level Field Summary

| Field | Type | Description |
|-------|------|-------------|
| `version` | string | Configuration version identifier |
| `map_id` | number | Reference ID to terrain map (-1 if none) |
| `map_translate` | object | Coordinate offset for map positioning |
| `machine_list` | object | Available machine specifications |
| `parameters` | array | User-defined parameters |
| `settings` | object | Global simulation settings |
| `zone_defaults` | object | Default values for zone types |
| `default_powernode_priorities` | object | Power node priority configurations |
| `economic_settings` | object | TCO calculation settings |
| `nodes` | array | Road network waypoints |
| `roads` | array | Road segments |
| `trolleys` | array | DET segments |
| `chargers` | array | SET zones |
| `service_stations` | array | Service zones |
| `load_zones` | array | Loading areas |
| `dump_zones` | array | Dumping areas |
| `haulers` | array | Hauler configurations |
| `loaders` | array | Loader configurations |
| `routes` | array | Fleet route assignments |
| `simulates` | array | Simulation configurations |
| `explorations` | array | DSE configurations |
| `esses` | array | Energy Storage Systems |
| `power_management` | object | Power distribution settings |
| `electrical_distributions` | array | Electrical network topology |
| `operations` | object | Operational parameters (delays, schedules) |
| `local_machines` | object | Locally saved machines |
| `batteries` | array | Battery configurations |
| `crushers` | array | Crusher configurations |
| `routeProcess` | object | Import process information |
| `cameraPosition` | object | 3D camera position |
| `controlTarget` | object | Camera control target |

---

## Nodes

Nodes represent waypoints in the road network. Each node defines a point with 3D coordinates and road properties.

### Structure

```json
{
  "id": 1,
  "coords": [100.5, 200.3, 50.0],
  "speed_limit": 65,
  "rolling_resistance": 2,
  "banking": 0,
  "curvature": "",
  "lane_width": "",
  "traction": ""
}
```

### Field Descriptions

| Field | Type | Unit | Required | Description |
|-------|------|------|----------|-------------|
| `id` | number | - | Yes | Unique node identifier |
| `coords` | array[3] | meters | Yes | 3D coordinates [x, y, z] |
| `speed_limit` | number/string | kph | Yes | Maximum allowed speed at this node |
| `rolling_resistance` | number/string | % | Yes | Road rolling resistance coefficient |
| `banking` | number/string | degrees | No | Road banking angle (super-elevation) |
| `curvature` | number/string | 1/m | No | Road curvature at this point |
| `lane_width` | number/string | meters | No | Lane width override |
| `traction` | number/string | - | No | Traction coefficient |

> **Note**: String values indicate parameter references (e.g., `"$param_name"`).

---

## Roads

Roads (segments) connect nodes to form the haul road network.

### Structure

```json
{
  "id": 1,
  "name": "Road 1",
  "nodes": [1, 2, 3],
  "is_generated": false,
  "ways_num": 2,
  "lanes_num": 2,
  "banking": 0,
  "lane_width": 14.525,
  "speed_limit": 65,
  "rolling_resistance": 2,
  "traction_coefficient": 0.6,
  "offset": 0
}
```

### Field Descriptions

| Field | Type | Unit | Required | Description |
|-------|------|------|----------|-------------|
| `id` | number | - | Yes | Unique road segment identifier |
| `name` | string | - | Yes | Display name of the road |
| `nodes` | array | - | Yes | Ordered list of node IDs forming the road path |
| `is_generated` | boolean | - | Yes | Whether road was auto-generated by zone creation |
| `ways_num` | number | - | Yes | Number of ways (directions) |
| `lanes_num` | number | - | Yes | Number of lanes per way |
| `banking` | number/string | degrees | No | Road banking angle (super-elevation) |
| `lane_width` | number/string | meters | No | Lane width |
| `speed_limit` | number/string | kph | No | Speed limit on this road |
| `rolling_resistance` | number/string | % | No | Rolling resistance coefficient |
| `traction_coefficient` | number/string | - | No | Traction coefficient |
| `offset` | number | meters | No | Road offset from centerline |

---

## Load Zones

Areas where haulers are loaded by loaders. Zones are auto-generated based on settings.

### Structure

```json
{
  "id": 1,
  "name": "LZ-01",
  "is_generated": true,
  "connector_zone_data": [],
  "settings": {
    "zonetype": "standard",
    "n_spots": 1,
    "n_entrances": 1,
    "roadlength": 100,
    "width": 50,
    "access_distance": 40,
    "angular_spread": 80,
    "clearance_radius": 80,
    "speed_limit": 20,
    "rolling_resistance": 2,
    "reverse_speed_limit": 5,
    "flip": false,
    "dtheta": 0,
    "queing": false,
    "inroad_ids": [1],
    "outroad_ids": [2],
    "innode_ids": [10],
    "outnode_ids": [12]
  }
}
```

### Field Descriptions

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `id` | number | Yes | Unique load zone identifier |
| `name` | string | Yes | Display name of the load zone |
| `is_generated` | boolean | Yes | Always `true` - zones are auto-generated |
| `connector_zone_data` | array | No | Connected charger/trolley data |
| `settings` | object | Yes | Zone generation settings |

### Settings Object

| Field | Type | Unit | Default | Description |
|-------|------|------|---------|-------------|
| `zonetype` | string | - | standard | Zone template type |
| `n_spots` | number | - | 1 | Number of loading spots |
| `n_entrances` | number | - | 1 | Number of entrances per spot |
| `roadlength` | number | meters | 100 | Generated road length |
| `width` | number | meters | 50 | Zone width |
| `access_distance` | number | meters | 40 | Access road distance |
| `angular_spread` | number | degrees | 80 | Angular spread for truck positioning |
| `clearance_radius` | number | meters | 80 | Clearance radius around zone |
| `speed_limit` | number/string | kph | "" | Speed limit within zone |
| `rolling_resistance` | number/string | % | "" | Rolling resistance in zone |
| `reverse_speed_limit` | number/string | kph | "" | Speed limit when reversing |
| `flip` | boolean | - | false | Flip zone orientation |
| `dtheta` | number | degrees | 0 | Rotation angle |
| `queing` | boolean | - | false | Enable queueing logic |
| `inroad_ids` | array | - | - | Entry road IDs |
| `outroad_ids` | array | - | - | Exit road IDs |
| `innode_ids` | array | - | - | Entry node IDs |
| `outnode_ids` | array | - | - | Exit node IDs |

### Zone Types

| Type | Description |
|------|-------------|
| `standard` | Standard loading configuration |
| `uturn` | U-turn loading configuration |
| `turnaround` | Turnaround loading configuration |
| `drivethrough` | Drive-through loading configuration |

---

## Dump Zones

Areas where haulers dump their payload. Zones are auto-generated based on settings.

### Structure

```json
{
  "id": 1,
  "name": "DZ-01",
  "is_generated": true,
  "connector_zone_data": [],
  "settings": {
    "zonetype": "standard",
    "n_spots": 1,
    "n_entrances": 1,
    "roadlength": 100,
    "width": 50,
    "access_distance": 40,
    "clearance_radius": 80,
    "speed_limit": 20,
    "rolling_resistance": 2,
    "reverse_speed_limit": 5,
    "flip": false,
    "dtheta": 0,
    "queing": false,
    "power_factor": 1.0,
    "inroad_ids": [1],
    "outroad_ids": [2],
    "innode_ids": [20],
    "outnode_ids": [22]
  }
}
```

### Field Descriptions

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `id` | number | Yes | Unique dump zone identifier |
| `name` | string | Yes | Display name of the dump zone |
| `is_generated` | boolean | Yes | Always `true` - zones are auto-generated |
| `connector_zone_data` | array | No | Connected charger/trolley data |
| `settings` | object | Yes | Zone generation settings |

### Settings Object

| Field | Type | Unit | Default | Description |
|-------|------|------|---------|-------------|
| `zonetype` | string | - | standard | Zone template type |
| `n_spots` | number | - | 1 | Number of dumping spots |
| `n_entrances` | number | - | 1 | Number of entrances per spot |
| `roadlength` | number | meters | 100 | Generated road length |
| `width` | number | meters | 50 | Zone width |
| `access_distance` | number | meters | 40 | Access road distance |
| `clearance_radius` | number | meters | 80 | Clearance radius around zone |
| `speed_limit` | number/string | kph | "" | Speed limit within zone |
| `rolling_resistance` | number/string | % | "" | Rolling resistance in zone |
| `reverse_speed_limit` | number/string | kph | "" | Speed limit when reversing |
| `flip` | boolean | - | false | Flip zone orientation |
| `dtheta` | number | degrees | 0 | Rotation angle |
| `queing` | boolean | - | false | Enable queueing logic |
| `power_factor` | number | ratio | 1.0 | Power factor for electrical calculations |
| `inroad_ids` | array | - | - | Entry road IDs |
| `outroad_ids` | array | - | - | Exit road IDs |
| `innode_ids` | array | - | - | Entry node IDs |
| `outnode_ids` | array | - | - | Exit node IDs |

### Connector Zone Data

| Field | Type | Description |
|-------|------|-------------|
| `charger_id` | number | Connected SET zone ID |
| `trolley_id` | number | Connected DET segment ID |
| `road` | number | Road ID for connection |
| `node` | number | Node ID for connection |

---

## File Format

- **Extension**: `.json`
- **Encoding**: UTF-8

---

*Document generated based on codebase analysis of PDM-Mineopt_Client.*
